function e(e,t=0){return+(Math.round(`${e}e+${t}`)+"e-"+t)}function t(e){return e&&0!==Object.keys(e).length&&e.constructor===Object}function n(e){return e?`${e.tagName.toLowerCase()}${e.className?".":""}${e.className.replace(/ /g,".")}`:null}const r="undefined"==typeof requestAnimationFrame?setTimeout:requestAnimationFrame,i="undefined"==typeof PerformanceObserver?null:PerformanceObserver,o="undefined"==typeof performance?null:performance,c=["mark","measure","resource","navigation"];function s(e,n){const s=t(e)?e:{type:e,buffered:!0},a=s.type.toLowerCase();if(!i)return u();try{const e=-1!==c.indexOf(a),t=i.supportedEntryTypes||c;if(!e&&-1===t.indexOf(a))return u();const l=new i(e=>{n(e.getEntries(),l)}),m=e?{entryTypes:[a]}:{...s,type:a};return l.observe(m),s.buffered&&e&&r(()=>{o&&o.getEntriesByType&&n(o.getEntriesByType(a),l)}),l}catch(e){return console.warn(e),u()}}function u(){return{observe(){},disconnect(){},takeRecords:()=>[]}}let a=[],l=!1;function m(e,t=0){a.push([e,t]),l||(l=!0,document.addEventListener("visibilitychange",(function e(){"hidden"===document.visibilityState&&(a.sort((e,t)=>e[1]-t[1]).forEach(([e])=>e()),a=[],document.removeEventListener("visibilitychange",e,!0))}),!0))}const f=Date.now();var p;p=({metricType:e,value:t})=>{chrome.runtime.sendMessage({[e]:t})},["fcp","fid",{type:"lcp",emit:!0},{type:"cls",emit:!0}].forEach(r=>{const i=t(r)?r:{type:r},c=i.type.toLowerCase();if("fcp"===c)return function(t){s("paint",(n,r)=>{if(n.some(e=>"first-contentful-paint"===e.name)){r.disconnect();const i=n.filter(e=>"first-contentful-paint"===e.name)[0];t({metricType:"fcp",value:e(i.startTime)})}})}(p);if("fid"===c)return function(t){s("first-input",([n],r)=>{n&&(r.disconnect(),t({metricType:"fid",value:e(n.processingStart-n.startTime),detail:{duration:n.duration,startTime:e(n.startTime,2),processingStart:e(n.processingStart,2),processingEnd:e(n.processingEnd,2),name:n.name}}))})}(p);if("lcp"===c)return function(t,r={}){const i=r.maxTimeout||1e4;let o=null,c=null,u=s("largest-contentful-paint",s=>{const u=s[s.length-1];c={metricType:"lcp",value:e(u.renderTime||u.loadTime),detail:{size:u.size,elementSelector:u.element?`${n(u.element.parentElement)} > ${n(u.element)}`:null}},o&&clearTimeout(o),o=setTimeout(l,i),r.emit&&t(c)}),a=s("first-input",l);function l(){u&&a&&(u.takeRecords(),u.disconnect(),u=null,a.disconnect(),a=null,o&&clearTimeout(o),c&&t(c))}m(l)}(p,i);if("cls"===c)return function(t,n={}){let r=null,i=0,c=0,u=s("layout-shift",e=>{const o=e.reduce((e,t)=>(t.hadRecentInput||(e+=t.value),e),0);i+=o,c+=e.length,r&&clearTimeout(r),n.maxTimeout&&(r=setTimeout(a,n.maxTimeout)),n.emit&&t(l())});function a(){u&&(u.takeRecords(),u.disconnect(),u=null,r&&clearTimeout(r),t(l()))}function l(){return{metricType:"cls",value:e(i,4),detail:{totalEntries:c,sessionDuration:o&&o.now?e(o.now()):Date.now()-f}}}m(a)}(p,i);throw new Error("Invalid metric type: "+i.type)});
