const e={fcp:{podr:400,median:3e3,weight:25},lcp:{podr:2250,median:4e3,weight:40},fid:{podr:40,median:300,weight:20},cls:{podr:.055,median:.25,weight:15}};function t(t,o={}){if(!t||0===Object.keys(t).length)throw new Error("Provide values");return function(e){if((e=e.filter(e=>e.weight>0)).some(e=>null===e.score))return null;const t=e.reduce((e,t)=>{const r=t.score,o=t.weight;return{weight:e.weight+o,sum:e.sum+r*o}},{weight:0,sum:0});return r(t.sum/t.weight||0)}(Object.keys(t).map(n=>{const s=n,c=t[s],i=o[s]||e[s];if(!i)throw new Error("Invalid metric: "+s);if("number"!=typeof c)throw new Error(`Invalid value: ${s}=${c}`);return{score:function(e,t,o){let n=function(e,t){const r=Math.log(e),o=Math.log(t/e),n=Math.sqrt(1-3*o-Math.sqrt((o-3)*(o-3)-8))/2;return{computeComplementaryPercentile:e=>(1-function(e){const t=Math.sign(e),r=1/(1+.3275911*(e=Math.abs(e)));return t*(1-r*(.254829592+r*(r*(1.421413741+r*(1.061405429*r-1.453152027))-.284496736))*Math.exp(-e*e))}((Math.log(e)-r)/(Math.SQRT2*n)))/2}}(o,t).computeComplementaryPercentile(e);return n=Math.min(1,n),n=Math.max(0,n),r(n)}(c,i.podr,i.median),weight:i.weight}}))}function r(e){return Math.round(100*e)/100}const o=new Map;chrome.tabs.onUpdated.addListener((e,t,r)=>{"complete"!==t.status?(!function(e){chrome.browserAction.setIcon({path:"/icons/icon-on.png"}),chrome.browserAction.setTitle({title:"Loading"}),chrome.browserAction.setBadgeText({text:"",tabId:e})}(e),o.set(e,null)):"complete"==t.status&&r.url&&r.url.startsWith("http")&&r.active&&chrome.tabs.executeScript({file:"assets/content.js"},()=>{const{lastError:t}=chrome.runtime;if(t&&e){const r=o.get(e);o.set(e,{...r,error:t.message}),console.log("Error: "+t.message),function(e){chrome.browserAction.setIcon({path:"/icons/icon-error.png",tabId:e}),chrome.browserAction.setBadgeText({text:"",tabId:e})}(e)}})}),chrome.runtime.onMessage.addListener((e,r)=>{const n=r.tab?r.tab.id:null;if(!n)return;const s={...(o.get(n)||{score:1,values:{}}).values,...e},c={score:t(s),values:s};o.set(n,c),function(e,t){if(!t.values.lcp)return;const r=t.score>=.9?"#42B29A":t.score>=.5?"#FFC15E":"$EF6853";chrome.browserAction.setTitle({title:JSON.stringify(t),tabId:e}),chrome.browserAction.setBadgeText({text:Math.round(100*t.score).toString(),tabId:e}),chrome.browserAction.setBadgeBackgroundColor({color:r,tabId:e})}(n,c)});
